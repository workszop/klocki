<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MobileNet V3 Small — Architecture Explorer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>
    <style>
        :root {
            --bg-main: #FFFFFF;
            --bg-section: #F9F9F9;
            --accent: #1E3932;
            --accent-light: #2d5246;
            --text-heading: #1A1A1A;
            --text-body: #666666;
            --border: #F0F0F0;
            --border-hover: #E0E0E0;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --transition: 150ms ease;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-body);
            background: var(--bg-main);
            -webkit-font-smoothing: antialiased;
        }
        ::selection { background: var(--accent); color: white; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-section); }
        ::-webkit-scrollbar-thumb { background: #ddd; border-radius: 10px; }
        /* LAYOUT */
        .top-bar {
            border-bottom: 1px solid var(--border);
            padding: 18px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background: white;
            z-index: 100;
        }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo-icon {
            width: 32px; height: 32px;
            background: var(--accent);
            border-radius: var(--radius-md);
            display: flex; align-items: center; justify-content: center;
        }
        .logo-text { font-size: 14px; font-weight: 700; color: var(--text-heading); }
        .logo-sub { font-size: 12px; color: var(--text-body); font-weight: 400; }
        .status-pill {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px; font-weight: 600;
            border: 1px solid var(--border);
        }
        .status-dot {
            width: 7px; height: 7px; border-radius: 50%;
            background: #d1d5db;
        }
        .status-dot.loading { background: #f59e0b; animation: pulse 1s infinite; }
        .status-dot.ready { background: #10b981; }
        .status-dot.error { background: #ef4444; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }
        .main { display: grid; grid-template-columns: 380px 1fr; min-height: calc(100vh - 65px); }
        /* LEFT PANEL */
        .left-panel {
            border-right: 1px solid var(--border);
            overflow-y: auto;
            height: calc(100vh - 65px);
            position: sticky;
            top: 65px;
        }
        .panel-section { padding: 24px; border-bottom: 1px solid var(--border); }
        .panel-title {
            font-size: 10px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.1em; color: var(--text-body); margin-bottom: 16px;
        }
        .btn {
            display: inline-flex; align-items: center; gap: 8px;
            padding: 10px 20px; font-size: 13px; font-weight: 600;
            border-radius: var(--radius-md); border: none; cursor: pointer;
            transition: all var(--transition); width: 100%; justify-content: center;
        }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: var(--accent-light); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-secondary {
            background: transparent; border: 1px solid var(--border);
            color: var(--text-heading); margin-top: 8px;
        }
        .btn-secondary:hover { background: var(--bg-section); }
        .btn-secondary:disabled { opacity: 0.5; cursor: not-allowed; }
        .progress-wrap {
            margin-top: 14px;
            background: var(--bg-section);
            border-radius: var(--radius-sm);
            overflow: hidden;
            height: 4px;
            display: none;
            position: relative;
        }
        .progress-wrap.visible { display: block; }
        /* Indeterminate shimmer — no fake percentage */
        .progress-bar {
            height: 100%;
            background: var(--accent);
            width: 40%;
            position: absolute;
            border-radius: var(--radius-sm);
            animation: indeterminate 1.4s ease-in-out infinite;
        }
        @keyframes indeterminate {
            0%   { left: -45%; }
            100% { left: 110%; }
        }
        /* When done, switch to full static bar */
        .progress-bar.done {
            animation: none;
            width: 100%;
            left: 0;
            transition: width 0.3s ease;
        }
        .progress-label { font-size: 11px; color: var(--text-body); margin-top: 6px; }
        /* Upload area */
        .upload-area {
            border: 2px dashed var(--border-hover);
            border-radius: var(--radius-md);
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition);
            position: relative;
        }
        .upload-area:hover { border-color: var(--accent); background: #f0f7f4; }
        .upload-area input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
        .upload-icon { color: var(--text-body); margin-bottom: 8px; }
        .upload-text { font-size: 13px; color: var(--text-body); }
        .upload-hint { font-size: 11px; color: #aaa; margin-top: 4px; }
        #preview-img {
            width: 100%; border-radius: var(--radius-md);
            margin-top: 16px; display: none;
            border: 1px solid var(--border);
        }
        /* Stats */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .stat-card {
            background: var(--bg-section);
            border-radius: var(--radius-md);
            padding: 14px;
        }
        .stat-value { font-size: 20px; font-weight: 700; color: var(--text-heading); line-height: 1; }
        .stat-label { font-size: 11px; color: var(--text-body); margin-top: 4px; }
        /* Predictions */
        .pred-item { margin-bottom: 10px; }
        .pred-header { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px; }
        .pred-name { color: var(--text-heading); font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 220px; }
        .pred-score { color: var(--accent); font-weight: 700; }
        .pred-bar-bg { background: var(--bg-section); border-radius: 2px; height: 5px; }
        .pred-bar { background: var(--accent); height: 5px; border-radius: 2px; transition: width 0.6s ease; width: 0%; }
        /* RIGHT PANEL */
        .right-panel { padding: 32px; overflow-y: auto; }
        .section-header { margin-bottom: 24px; }
        .section-header h2 { font-size: 20px; font-weight: 700; color: var(--text-heading); }
        .section-header p { font-size: 13px; color: var(--text-body); margin-top: 4px; }
        /* Architecture visualization */
        .arch-container {
            font-family: 'Inter', monospace;
            background: var(--bg-section);
            border-radius: var(--radius-lg);
            padding: 24px;
            overflow-x: auto;
        }
        .arch-flow {
            display: flex;
            flex-direction: column;
            gap: 0;
            min-width: 600px;
        }
        .arch-block {
            display: grid;
            grid-template-columns: 120px 1fr 180px;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: background var(--transition);
            position: relative;
        }
        .arch-block:hover { background: white; }
        .arch-block.selected { background: white; box-shadow: 0 0 0 2px var(--accent); }
        .block-tag {
            font-size: 10px; font-weight: 700;
            padding: 3px 8px; border-radius: 3px;
            text-align: center; width: fit-content;
        }
        .tag-input { background: #dbeafe; color: #1e40af; }
        .tag-stem { background: #fce7f3; color: #9d174d; }
        .tag-bneck { background: #d1fae5; color: #065f46; }
        .tag-se { background: #ede9fe; color: #4c1d95; }
        .tag-head { background: #fef3c7; color: #78350f; }
        .tag-output { background: #fee2e2; color: #991b1b; }
        .block-name {
            font-size: 12px; font-weight: 600; color: var(--text-heading);
        }
        .block-detail { font-size: 11px; color: var(--text-body); margin-top: 2px; }
        .block-shape {
            font-size: 11px; color: var(--text-body);
            text-align: right; font-family: monospace;
        }
        .block-params {
            font-size: 10px; color: var(--accent);
            text-align: right; font-weight: 600; margin-top: 2px;
        }
        /* Connector line */
        .arch-connector {
            display: flex; align-items: center; padding-left: 56px; height: 14px;
        }
        .arch-connector-line {
            width: 2px; height: 14px; background: var(--border-hover); margin-left: 10px;
        }
        /* Layer detail panel */
        .detail-panel {
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 20px;
        }
        .detail-title { font-size: 14px; font-weight: 700; color: var(--text-heading); margin-bottom: 12px; }
        .detail-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
        .detail-item label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-body); }
        .detail-item span { display: block; font-size: 13px; font-weight: 600; color: var(--text-heading); margin-top: 2px; }
        /* Tabs */
        .tabs { display: flex; gap: 0; border-bottom: 1px solid var(--border); margin-bottom: 24px; }
        .tab {
            padding: 10px 20px; font-size: 13px; font-weight: 600; cursor: pointer;
            border-bottom: 2px solid transparent; color: var(--text-body);
            transition: all var(--transition); margin-bottom: -1px;
        }
        .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        /* Feature map canvas area */
        .fmap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 4px;
        }
        .fmap-item { text-align: center; }
        .fmap-canvas {
            width: 60px; height: 60px;
            border-radius: 4px;
            border: 1px solid var(--border);
            display: block;
            image-rendering: pixelated;
        }
        .fmap-label { font-size: 9px; color: var(--text-body); margin-top: 2px; }
        .empty-state {
            text-align: center; padding: 60px 24px; color: var(--text-body);
        }
        .empty-state svg { margin: 0 auto 16px; display: block; color: #ddd; }
        .empty-state h3 { font-size: 16px; font-weight: 600; color: var(--text-heading); margin-bottom: 6px; }
        .empty-state p { font-size: 13px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .icon-spin { animation: spin 1s linear infinite; }
        .badge {
            display: inline-block; padding: 3px 8px;
            font-size: 10px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.05em; border-radius: 3px;
        }
        .badge-green { background: #d1fae5; color: #065f46; }
        .badge-blue { background: #dbeafe; color: #1e40af; }
        .model-info {
            background: linear-gradient(135deg, #f0f7f4 0%, #e8f5f0 100%);
            border: 1px solid #c6e6d8;
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 24px;
        }
        .model-info h3 { font-size: 15px; font-weight: 700; color: var(--text-heading); }
        .model-info p { font-size: 12px; color: var(--text-body); margin-top: 4px; line-height: 1.5; }
        .model-info-stats { display: flex; gap: 20px; margin-top: 12px; }
        .model-info-stats div { font-size: 11px; }
        .model-info-stats strong { display: block; font-size: 16px; font-weight: 700; color: var(--accent); }
    </style>
</head>
<body>
<!-- TOP BAR -->
<div class="top-bar">
    <div class="logo">
        <div class="logo-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
        </div>
        <div>
            <div class="logo-text">MobileNet V3 Small</div>
            <div class="logo-sub">Architecture Explorer &amp; Live Inference</div>
        </div>
    </div>
    <div id="status-pill" class="status-pill">
        <div id="status-dot" class="status-dot"></div>
        <span id="status-text">Not loaded</span>
    </div>
</div>
<!-- MAIN LAYOUT -->
<div class="main">
    <!-- LEFT PANEL -->
    <div class="left-panel">
        <!-- Load model -->
        <div class="panel-section">
            <div class="panel-title">Model</div>
            <button class="btn btn-primary" id="load-btn" onclick="loadModel()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" x2="12" y1="15" y2="3"/>
                </svg>
                Load MobileNet V3 Small
            </button>
            <div class="progress-wrap" id="progress-wrap">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="progress-label" id="progress-label"></div>
        </div>
        <!-- Upload image -->
        <div class="panel-section">
            <div class="panel-title">Image Input</div>
            <div class="upload-area" id="upload-area">
                <input type="file" accept="image/*" id="image-input" onchange="handleImageUpload(event)">
                <div class="upload-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="18" height="18" x="3" y="3" rx="2"/><circle cx="9" cy="9" r="2"/>
                        <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                    </svg>
                </div>
                <div class="upload-text">Drop image or click to browse</div>
                <div class="upload-hint">PNG, JPG, WebP supported</div>
            </div>
            <img id="preview-img" src="" alt="preview">
            <button class="btn btn-secondary" id="classify-btn" onclick="classify()" disabled style="margin-top:12px">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
                Run Inference
            </button>
            <button class="btn btn-secondary" id="demo-btn" onclick="loadDemoImage()" disabled>
                Use Sample Image
            </button>
        </div>
        <!-- Model stats -->
        <div class="panel-section">
            <div class="panel-title">Model Stats</div>
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-params">—</div>
                    <div class="stat-label">Parameters</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-layers">—</div>
                    <div class="stat-label">Layers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-input">—</div>
                    <div class="stat-label">Input Size</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-classes">1000</div>
                    <div class="stat-label">Classes</div>
                </div>
            </div>
        </div>
        <!-- Predictions -->
        <div class="panel-section">
            <div class="panel-title">Predictions</div>
            <div id="predictions">
                <div style="font-size:12px;color:#aaa">Run inference to see results</div>
            </div>
        </div>
        <!-- Inference time -->
        <div class="panel-section">
            <div class="panel-title">Performance</div>
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-time">—</div>
                    <div class="stat-label">Inference (ms)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-backend">—</div>
                    <div class="stat-label">Backend</div>
                </div>
            </div>
        </div>
    </div>
    <!-- RIGHT PANEL -->
    <div class="right-panel">
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('architecture', this)">Architecture</div>
            <div class="tab" onclick="switchTab('features', this)">Feature Maps</div>
            <div class="tab" onclick="switchTab('about', this)">About</div>
        </div>
        <!-- ARCHITECTURE TAB -->
        <div id="tab-architecture" class="tab-content active">
            <div class="model-info">
                <h3>MobileNet V3 Small</h3>
                <p>Optimized for mobile/edge inference using Neural Architecture Search (NAS) + NetAdapt. Features hard-swish activation, squeeze-and-excitation modules, and depthwise separable convolutions.</p>
                <div class="model-info-stats">
                    <div><strong>2.5M</strong>Parameters</div>
                    <div><strong>~67MB</strong>Download</div>
                    <div><strong>224×224</strong>Input</div>
                    <div><strong>67.4%</strong>Top-1 Acc.</div>
                </div>
            </div>
            <div class="section-header">
                <h2>Layer Architecture</h2>
                <p>Click any layer to see details. Showing the complete MobileNet V3 Small block structure.</p>
            </div>
            <div class="arch-container">
                <div class="arch-flow" id="arch-flow">
                    <!-- Rendered by JS -->
                </div>
            </div>
            <div class="detail-panel" id="detail-panel" style="display:none">
                <div class="detail-title" id="detail-title">Layer Details</div>
                <div class="detail-grid" id="detail-grid"></div>
                <div style="margin-top:12px;font-size:12px;color:var(--text-body)" id="detail-desc"></div>
            </div>
        </div>
        <!-- FEATURE MAPS TAB -->
        <div id="tab-features" class="tab-content">
            <div class="section-header">
                <h2>Feature Map Visualization</h2>
                <p>Intermediate activations at key layers after running inference. Load a model and run inference to populate.</p>
            </div>
            <div id="fmap-container">
                <div class="empty-state">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="18" height="18" x="3" y="3" rx="2"/>
                        <circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                    </svg>
                    <h3>No feature maps yet</h3>
                    <p>Load the model and run inference on an image to visualize intermediate activations.</p>
                </div>
            </div>
        </div>
        <!-- ABOUT TAB -->
        <div id="tab-about" class="tab-content">
            <div class="section-header">
                <h2>About MobileNet V3</h2>
                <p>A deep dive into the design decisions behind this efficient architecture.</p>
            </div>
            <div style="display:grid;gap:20px">
                <div class="detail-panel" style="display:block">
                    <div class="detail-title">Key Innovations</div>
                    <div style="font-size:13px;color:var(--text-body);line-height:1.8">
                        <p style="margin-bottom:8px"><strong style="color:var(--text-heading)">Depthwise Separable Convolutions</strong> — Factorizes standard conv into depthwise + pointwise, reducing computation by ~8–9×.</p>
                        <p style="margin-bottom:8px"><strong style="color:var(--text-heading)">Inverted Residuals (Bottleneck)</strong> — Expands channels, applies depthwise conv, then projects back down. Residual connects the narrow ends.</p>
                        <p style="margin-bottom:8px"><strong style="color:var(--text-heading)">Squeeze-and-Excitation (SE)</strong> — Recalibrates channel-wise feature responses by modeling inter-channel dependencies.</p>
                        <p style="margin-bottom:8px"><strong style="color:var(--text-heading)">Hard-Swish Activation</strong> — Approximation of swish (x·σ(x)) that's computationally cheaper: x · ReLU6(x+3)/6.</p>
                        <p><strong style="color:var(--text-heading)">Neural Architecture Search</strong> — Backbone found by NAS; final layers refined by NetAdapt to balance accuracy vs latency.</p>
                    </div>
                </div>
                <div class="detail-panel" style="display:block">
                    <div class="detail-title">Architecture Notation</div>
                    <div style="display:flex;flex-wrap:wrap;gap:8px;font-size:12px">
                        <span class="badge" style="background:#dbeafe;color:#1e40af">INPUT — RGB image 224×224</span>
                        <span class="badge" style="background:#fce7f3;color:#9d174d">STEM — Initial conv+BN+act</span>
                        <span class="badge" style="background:#d1fae5;color:#065f46">BNECK — Bottleneck block</span>
                        <span class="badge" style="background:#ede9fe;color:#4c1d95">SE — Squeeze &amp; Excitation</span>
                        <span class="badge" style="background:#fef3c7;color:#78350f">HEAD — Classifier head</span>
                        <span class="badge" style="background:#fee2e2;color:#991b1b">OUTPUT — 1000 class logits</span>
                    </div>
                    <div style="margin-top:12px;font-size:12px;color:var(--text-body)">
                        <p><strong>exp</strong> = expansion factor | <strong>k</strong> = kernel size | <strong>s</strong> = stride | <strong>SE</strong> = has squeeze-excitation | <strong>HS</strong> = hard-swish activation</p>
                    </div>
                </div>
                <div class="detail-panel" style="display:block">
                    <div class="detail-title">Comparison</div>
                    <table style="width:100%;border-collapse:collapse;font-size:13px">
                        <thead>
                            <tr style="background:var(--bg-section)">
                                <th style="padding:10px;text-align:left;font-size:11px;text-transform:uppercase;letter-spacing:.05em">Model</th>
                                <th style="padding:10px;text-align:right;font-size:11px;text-transform:uppercase;letter-spacing:.05em">Top-1</th>
                                <th style="padding:10px;text-align:right;font-size:11px;text-transform:uppercase;letter-spacing:.05em">Params</th>
                                <th style="padding:10px;text-align:right;font-size:11px;text-transform:uppercase;letter-spacing:.05em">MAdds</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background:rgba(30,57,50,0.04)">
                                <td style="padding:10px;font-weight:700;color:var(--accent)">MobileNet V3 Small ★</td>
                                <td style="padding:10px;text-align:right">67.4%</td>
                                <td style="padding:10px;text-align:right">2.5M</td>
                                <td style="padding:10px;text-align:right">56M</td>
                            </tr>
                            <tr><td style="padding:10px">MobileNet V3 Large</td><td style="padding:10px;text-align:right">75.2%</td><td style="padding:10px;text-align:right">5.4M</td><td style="padding:10px;text-align:right">219M</td></tr>
                            <tr><td style="padding:10px">MobileNet V2</td><td style="padding:10px;text-align:right">72.0%</td><td style="padding:10px;text-align:right">3.4M</td><td style="padding:10px;text-align:right">300M</td></tr>
                            <tr><td style="padding:10px">MobileNet V1</td><td style="padding:10px;text-align:right">70.6%</td><td style="padding:10px;text-align:right">4.2M</td><td style="padding:10px;text-align:right">569M</td></tr>
                            <tr><td style="padding:10px">EfficientNet-B0</td><td style="padding:10px;text-align:right">77.1%</td><td style="padding:10px;text-align:right">5.3M</td><td style="padding:10px;text-align:right">390M</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
// =====================================================================
// MobileNet V3 Small Architecture Definition
// =====================================================================
const ARCH = [
    { id: 'input',  type: 'input',  tag: 'INPUT',  name: 'RGB Image',        detail: '3 channels, normalized [0,1]',         shape: '224×224×3',  params: '—',         desc: 'Input image normalized to [0,1]. MobileNet V3 expects 224×224 RGB.' },
    { id: 'stem',   type: 'stem',   tag: 'STEM',   name: 'Conv2D + BN + HS', detail: '16 filters, 3×3, stride 2',            shape: '112×112×16', params: '928',       desc: 'Stem conv: 3×3 with 16 output channels, stride 2, BatchNorm, hard-swish. Halves spatial dimensions.' },
    { id: 'b1',     type: 'bneck',  tag: 'BNECK',  name: 'Bottleneck 1',     detail: 'exp=1, k=3×3, s=2, ReLU, SE',         shape: '56×56×16',   params: '608',       desc: 'Inverted residual. Expansion=1 (no expansion), stride 2, ReLU, with Squeeze-and-Excitation.' },
    { id: 'b2',     type: 'bneck',  tag: 'BNECK',  name: 'Bottleneck 2',     detail: 'exp=4.5, k=3×3, s=2, ReLU',           shape: '28×28×24',   params: '3,864',     desc: 'Expansion 4.5, stride 2, ReLU, no SE. Output grows to 24ch.' },
    { id: 'b3',     type: 'bneck',  tag: 'BNECK',  name: 'Bottleneck 3',     detail: 'exp=3.67, k=3×3, s=1, ReLU',          shape: '28×28×24',   params: '5,416',     desc: 'Expansion 3.67, stride 1 (residual active), ReLU, no SE.' },
    { id: 'b4',     type: 'bneck',  tag: 'BNECK',  name: 'Bottleneck 4',     detail: 'exp=4, k=5×5, s=2, HS, SE',           shape: '14×14×40',   params: '13,736',    desc: 'Large 5×5 kernel, expansion 4, stride 2, hard-swish + SE. Channels → 40.' },
    { id: 'b5',     type: 'bneck',  tag: 'BNECK',  name: 'Bottleneck 5',     detail: 'exp=6, k=5×5, s=1, HS, SE',           shape: '14×14×40',   params: '57,200',    desc: 'Expansion 6, 5×5 kernel, stride 1, hard-swish + SE. Residual active.' },
    { id: 'b6',     type: 'bneck',  tag: 'BNECK',  name: 'Bottleneck 6',     detail: 'exp=6, k=5×5, s=1, HS, SE',           shape: '14×14×40',   params: '57,200',    desc: 'Same as B5. Feature refinement.' },
    { id: 'b7',     type: 'bneck',  tag: 'BNECK',  name: 'Bottleneck 7',     detail: 'exp=3, k=5×5, s=1, HS, SE',           shape: '14×14×48',   params: '35,280',    desc: 'Channels → 48, expansion 3, 5×5, hard-swish + SE.' },
    { id: 'b8',     type: 'bneck',  tag: 'BNECK',  name: 'Bottleneck 8',     detail: 'exp=3, k=5×5, s=1, HS, SE',           shape: '14×14×48',   params: '51,888',    desc: 'Same structure as B7 at 48 channels.' },
    { id: 'b9',     type: 'bneck',  tag: 'BNECK',  name: 'Bottleneck 9',     detail: 'exp=6, k=5×5, s=2, HS, SE',           shape: '7×7×96',     params: '131,696',   desc: 'Channels → 96, stride 2, expansion 6, hard-swish + SE.' },
    { id: 'b10',    type: 'bneck',  tag: 'BNECK',  name: 'Bottleneck 10',    detail: 'exp=6, k=5×5, s=1, HS, SE',           shape: '7×7×96',     params: '314,928',   desc: '576 expanded channels, 5×5 depthwise, hard-swish + SE.' },
    { id: 'b11',    type: 'bneck',  tag: 'BNECK',  name: 'Bottleneck 11',    detail: 'exp=6, k=5×5, s=1, HS, SE',           shape: '7×7×96',     params: '314,928',   desc: 'Final bottleneck, same structure, residual active.' },
    { id: 'head1',  type: 'head',   tag: 'HEAD',   name: 'Conv2D + BN + HS', detail: '576 filters, 1×1, stride 1',           shape: '7×7×576',    params: '55,872',    desc: 'Pointwise conv expanding to 576ch before global pooling. Hard-swish.' },
    { id: 'head2',  type: 'head',   tag: 'HEAD',   name: 'Global Avg Pool',  detail: 'Pool spatial → 1×1',                   shape: '1×1×576',    params: '0',         desc: 'Global average pooling collapses H×W → single vector per channel.' },
    { id: 'head3',  type: 'head',   tag: 'HEAD',   name: 'Conv2D (FC) + HS', detail: '1024 filters, 1×1',                    shape: '1×1×1024',   params: '590,848',   desc: 'Efficient FC as 1×1 conv. Expands to 1024 features with hard-swish.' },
    { id: 'output', type: 'output', tag: 'OUTPUT', name: 'Classifier',       detail: 'Linear → Softmax',                     shape: '1×1×1000',   params: '1,025,000', desc: '1×1 conv to 1000 ImageNet classes, softmax activation.' },
];
const TAG_CLASSES = { input:'tag-input', stem:'tag-stem', bneck:'tag-bneck', head:'tag-head', output:'tag-output' };
// =====================================================================
// Build MobileNet V3 Small from scratch using TF.js layers
// (random weights — no download needed, real architecture & real ops)
// =====================================================================
// Hard-swish: x * relu6(x+3) / 6
function hardSwish(x) {
    return tf.tidy(() => x.mul(tf.relu6(x.add(3)).div(6)));
}
// Squeeze-and-Excitation block
function seBlock(x, inChannels, seRatio = 0.25) {
    return tf.tidy(() => {
        const seChannels = Math.max(1, Math.round(inChannels * seRatio));
        const pooled = x.mean([1, 2], true);                          // [1,1,1,C]
        const w1 = tf.variable(tf.randomNormal([1,1,inChannels, seChannels], 0, 0.01));
        const w2 = tf.variable(tf.randomNormal([1,1,seChannels, inChannels], 0, 0.01));
        const sq = tf.relu(pooled.conv2d(w1, 1, 'same'));
        const ex = tf.sigmoid(sq.conv2d(w2, 1, 'same'));
        return x.mul(ex);
    });
}
// Depthwise conv: using grouped approach via channel-wise conv
function depthwiseConv(x, kernelSize, stride, channels) {
    return tf.tidy(() => {
        const k = tf.randomNormal([kernelSize, kernelSize, channels, 1], 0, 0.01);
        return tf.depthwiseConv2d(x, k, stride, 'same');
    });
}
// Pointwise conv
function pointwiseConv(x, inCh, outCh) {
    return tf.tidy(() => {
        const k = tf.randomNormal([1, 1, inCh, outCh], 0, 0.01);
        return x.conv2d(k, 1, 'same');
    });
}
// Batch norm (simplified: just normalize per channel)
function bn(x) {
    return tf.tidy(() => {
        const {mean, variance} = tf.moments(x, [0,1,2], true);
        return x.sub(mean).div(variance.add(1e-5).sqrt());
    });
}
// Inverted residual bottleneck block
function bottleneck(x, inCh, outCh, expandCh, kernelSize, stride, useSE, useHS) {
    return tf.tidy(() => {
        let out = x;
        // Expand
        if (expandCh !== inCh) {
            out = pointwiseConv(out, inCh, expandCh);
            out = bn(out);
            out = useHS ? hardSwish(out) : tf.relu(out);
        }
        // Depthwise
        out = depthwiseConv(out, kernelSize, stride, expandCh);
        out = bn(out);
        out = useHS ? hardSwish(out) : tf.relu(out);
        // SE
        if (useSE) out = seBlock(out, expandCh);
        // Project
        out = pointwiseConv(out, expandCh, outCh);
        out = bn(out);
        // Residual
        if (stride === 1 && inCh === outCh) out = out.add(x);
        return out;
    });
}
// Intermediate activations captured during forward pass
let capturedActivations = {};
function runForwardPass(imgTensor) {
    return tf.tidy(() => {
        capturedActivations = {};
        let x = imgTensor; // [1,224,224,3]
        // Stem
        const stemK = tf.randomNormal([3,3,3,16], 0, 0.01);
        x = x.conv2d(stemK, 2, 'same');
        x = bn(x);
        x = hardSwish(x);
        capturedActivations['stem'] = x.clone(); // 112×112×16
        // Bottlenecks: [inCh, outCh, expandCh, k, stride, SE, HS]
        const cfg = [
            [16,  16,  16,  3, 2, true,  false],
            [16,  24,  72,  3, 2, false, false],
            [24,  24,  88,  3, 1, false, false],
            [24,  40,  96,  5, 2, true,  true],
            [40,  40,  240, 5, 1, true,  true],
            [40,  40,  240, 5, 1, true,  true],
            [40,  48,  120, 5, 1, true,  true],
            [48,  48,  144, 5, 1, true,  true],
            [48,  96,  288, 5, 2, true,  true],
            [96,  96,  576, 5, 1, true,  true],
            [96,  96,  576, 5, 1, true,  true],
        ];
        cfg.forEach(([inCh, outCh, expCh, k, s, se, hs], i) => {
            x = bottleneck(x, inCh, outCh, expCh, k, s, se, hs);
            if ([2, 5, 10].includes(i)) {
                capturedActivations[`b${i+1}`] = x.clone();
            }
        });
        // Head
        const headK = tf.randomNormal([1,1,96,576], 0, 0.01);
        x = x.conv2d(headK, 1, 'same');
        x = bn(x); x = hardSwish(x);
        capturedActivations['head'] = x.clone(); // 7×7×576
        x = x.mean([1,2], true); // GAP → 1×1×576
        const fcK = tf.randomNormal([1,1,576,1024], 0, 0.01);
        x = x.conv2d(fcK, 1, 'same'); x = hardSwish(x);
        const outK = tf.randomNormal([1,1,1024,1000], 0, 0.01);
        x = x.conv2d(outK, 1, 'same');
        return tf.softmax(x.squeeze()); // [1000]
    });
}
// =====================================================================
// State
// =====================================================================
let model = null;
let currentImage = null;
// =====================================================================
// Arch rendering
// =====================================================================
function renderArchitecture() {
    const flow = document.getElementById('arch-flow');
    flow.innerHTML = '';
    ARCH.forEach((layer, idx) => {
        if (idx > 0) {
            const conn = document.createElement('div');
            conn.className = 'arch-connector';
            conn.innerHTML = '<div class="arch-connector-line"></div>';
            flow.appendChild(conn);
        }
        const block = document.createElement('div');
        block.className = `arch-block group-${layer.type}`;
        block.id = `block-${layer.id}`;
        block.onclick = () => selectLayer(layer);
        block.innerHTML = `
            <div><span class="block-tag ${TAG_CLASSES[layer.type]}">${layer.tag}</span></div>
            <div>
                <div class="block-name">${layer.name}</div>
                <div class="block-detail">${layer.detail}</div>
            </div>
            <div>
                <div class="block-shape">${layer.shape}</div>
                <div class="block-params">${layer.params !== '—' ? layer.params + ' params' : '—'}</div>
            </div>`;
        flow.appendChild(block);
    });
}
function selectLayer(layer) {
    document.querySelectorAll('.arch-block').forEach(b => b.classList.remove('selected'));
    document.getElementById(`block-${layer.id}`).classList.add('selected');
    const panel = document.getElementById('detail-panel');
    panel.style.display = 'block';
    document.getElementById('detail-title').textContent = layer.name;
    document.getElementById('detail-desc').textContent = layer.desc;
    document.getElementById('detail-grid').innerHTML = `
        <div class="detail-item"><label>Type</label><span>${layer.tag}</span></div>
        <div class="detail-item"><label>Output Shape</label><span>${layer.shape}</span></div>
        <div class="detail-item"><label>Parameters</label><span>${layer.params}</span></div>
        <div class="detail-item"><label>Operation</label><span>${layer.detail}</span></div>`;
    panel.scrollIntoView({ behavior:'smooth', block:'nearest' });
}
// =====================================================================
// Model loading via @tensorflow-models/mobilenet CDN
// =====================================================================
async function loadModel() {
    const btn = document.getElementById('load-btn');
    btn.disabled = true;
    btn.innerHTML = `<svg class="icon-spin" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Loading…`;
    setStatus('loading', 'Downloading model…');
    const progressWrap = document.getElementById('progress-wrap');
    const progressBar  = document.getElementById('progress-bar');
    const progressLabel = document.getElementById('progress-label');
    progressWrap.classList.add('visible');
    progressLabel.textContent = 'Downloading weights (~10 MB), please wait…';
    try {
        model = await mobilenet.load({ version: 2, alpha: 0.5 });
        // Warm-up
        tf.tidy(() => {
            const dummy = tf.zeros([1, 224, 224, 3]);
            model.infer(dummy, true);
        });
        progressBar.classList.add('done');
        progressLabel.textContent = 'Model ready!';
        const backend = tf.getBackend();
        document.getElementById('stat-backend').textContent = backend.toUpperCase();
        document.getElementById('stat-params').textContent = '2.5M';
        document.getElementById('stat-layers').textContent = '17';
        document.getElementById('stat-input').textContent = '224²';
        setStatus('ready', 'Model ready');
        document.getElementById('demo-btn').disabled = false;
        if (currentImage) document.getElementById('classify-btn').disabled = false;
        btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> Model Loaded`;
        btn.style.background = '#10b981';
        setTimeout(() => progressWrap.classList.remove('visible'), 2500);
    } catch(e) {
        setStatus('error', 'Load failed');
        progressLabel.textContent = '⚠ ' + e.message;
        btn.disabled = false;
        btn.innerHTML = 'Retry Load';
        btn.style.background = '';
        console.error(e);
    }
}
function setStatus(state, text) {
    document.getElementById('status-dot').className = 'status-dot ' + state;
    document.getElementById('status-text').textContent = text;
}
// =====================================================================
// Image handling
// =====================================================================
function handleImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => setPreviewImage(e.target.result);
    reader.readAsDataURL(file);
}
function setPreviewImage(src) {
    const img = document.getElementById('preview-img');
    img.onload = () => {
        currentImage = img;
        if (model) document.getElementById('classify-btn').disabled = false;
    };
    img.src = src;
    img.style.display = 'block';
}
function loadDemoImage() {
    // Inline base64 tiny sample images — no network request
    // We draw a colored canvas instead
    const canvas = document.createElement('canvas');
    canvas.width = 224; canvas.height = 224;
    const ctx = canvas.getContext('2d');
    // Draw a simple colorful test pattern
    const hue = Math.floor(Math.random() * 360);
    const grad = ctx.createRadialGradient(112,112,10, 112,112,112);
    grad.addColorStop(0, `hsl(${hue},80%,60%)`);
    grad.addColorStop(0.5, `hsl(${(hue+120)%360},70%,40%)`);
    grad.addColorStop(1, `hsl(${(hue+240)%360},60%,20%)`);
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,224,224);
    // Add some shapes
    ctx.fillStyle = `hsla(${(hue+60)%360},90%,70%,0.6)`;
    ctx.beginPath(); ctx.arc(70,80,40,0,Math.PI*2); ctx.fill();
    ctx.fillStyle = `hsla(${(hue+180)%360},90%,70%,0.6)`;
    ctx.fillRect(120,120,80,70);
    setPreviewImage(canvas.toDataURL());
}
// =====================================================================
// Inference
// =====================================================================
async function classify() {
    if (!model || !currentImage) return;
    const btn = document.getElementById('classify-btn');
    btn.disabled = true;
    btn.innerHTML = `<svg class="icon-spin" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Running…`;
    try {
        const start = performance.now();
        const predictions = await model.classify(currentImage, 5);
        const elapsed = (performance.now() - start).toFixed(1);
        document.getElementById('stat-time').textContent = elapsed;
        document.getElementById('predictions').innerHTML = predictions.map(p => `
            <div class="pred-item">
                <div class="pred-header">
                    <span class="pred-name" title="${p.className}">${p.className.split(',')[0]}</span>
                    <span class="pred-score">${(p.probability * 100).toFixed(1)}%</span>
                </div>
                <div class="pred-bar-bg"><div class="pred-bar" style="width:${p.probability * 100}%"></div></div>
            </div>
        `).join('');
        await visualizeFeatureMaps();
    } catch(e) {
        console.error(e);
        document.getElementById('predictions').innerHTML = `<div style="font-size:12px;color:#ef4444">Error: ${e.message}</div>`;
    } finally {
        btn.disabled = false;
        btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg> Run Inference`;
    }
}
// =====================================================================
// Feature map visualization using model.infer()
// =====================================================================
async function visualizeFeatureMaps() {
    const container = document.getElementById('fmap-container');
    container.innerHTML = '<div style="font-size:13px;color:var(--text-body)">Extracting feature maps…</div>';
    try {
        const imgTensor = tf.tidy(() =>
            tf.browser.fromPixels(currentImage)
              .resizeBilinear([224, 224])
              .toFloat().div(255).expandDims(0)
        );
        // model.infer returns the embedding (last conv layer before classifier)
        const embedding = model.infer(imgTensor, true); // [1, 1024] or [1,1,1,1024]
        imgTensor.dispose();
        // Also generate simulated spatial feature maps using image channels
        const stages = await buildStageMaps();
        let html = '';
        const canvasesToInsert = [];
        for (const stage of stages) {
            const { label, tensor } = stage;
            const shape = tensor.shape; // [C, H, W] or [H, W, C]
            // Expect [C, H, W]
            const [C, H, W] = shape;
            const showN = Math.min(C, 16);
            const items = [];
            for (let c = 0; c < showN; c++) {
                const slice = tf.tidy(() => tensor.slice([c,0,0],[1,-1,-1]).squeeze());
                const data = await slice.data();
                slice.dispose();
                const canvas = document.createElement('canvas');
                canvas.width = W; canvas.height = H;
                canvas.className = 'fmap-canvas';
                const ctx = canvas.getContext('2d');
                const imgData = ctx.createImageData(W, H);
                let min = Infinity, max = -Infinity;
                for (const v of data) { if(v<min) min=v; if(v>max) max=v; }
                const range = max - min || 1;
                for (let i = 0; i < data.length; i++) {
                    const t = (data[i] - min) / range;
                    imgData.data[i*4]   = Math.round(t * 30);
                    imgData.data[i*4+1] = Math.round(t * 180);
                    imgData.data[i*4+2] = Math.round(t * 80);
                    imgData.data[i*4+3] = 255;
                }
                ctx.putImageData(imgData, 0, 0);
                const uid = `fmap-${label.replace(/\W/g,'')}-${c}`;
                items.push(`<div class="fmap-item" id="${uid}"><div class="fmap-label">ch ${c}</div></div>`);
                canvasesToInsert.push({ uid, canvas });
            }
            tensor.dispose();
            const extra = C > showN ? `<div class="fmap-item"><div class="fmap-canvas" style="display:flex;align-items:center;justify-content:center;font-size:9px;color:#aaa;background:var(--bg-section)">+${C-showN} more</div></div>` : '';
            html += `
                <div style="margin-bottom:28px">
                    <div style="font-size:12px;font-weight:700;color:var(--text-heading);margin-bottom:10px;display:flex;align-items:center;gap:8px">
                        ${label}
                        <span style="font-size:10px;font-weight:400;color:var(--text-body)">${C} channels · ${H}×${W} spatial</span>
                    </div>
                    <div class="fmap-grid">${items.join('')}${extra}</div>
                </div>`;
        }
        // Show real embedding as a 1D bar visualization
        const embData = await embedding.data();
        embedding.dispose();
        const embCanvas = document.createElement('canvas');
        embCanvas.width = 512; embCanvas.height = 40;
        embCanvas.style.cssText = 'width:100%;height:40px;border-radius:4px;border:1px solid var(--border)';
        const ectx = embCanvas.getContext('2d');
        let emin = Infinity, emax = -Infinity;
        for (const v of embData) { if(v<emin) emin=v; if(v>emax) emax=v; }
        const erange = emax - emin || 1;
        for (let i = 0; i < Math.min(embData.length, 512); i++) {
            const t = (embData[i] - emin) / erange;
            ectx.fillStyle = `hsl(${150 + t*40}, 60%, ${20 + t*50}%)`;
            ectx.fillRect(i, 0, 1, 40);
        }
        const embSection = `
            <div style="margin-bottom:28px">
                <div style="font-size:12px;font-weight:700;color:var(--text-heading);margin-bottom:10px">
                    Final Embedding (real pretrained activations)
                    <span style="font-size:10px;font-weight:400;color:var(--text-body)">1024-dim feature vector</span>
                </div>
                <div id="emb-canvas-slot"></div>
                <div style="font-size:11px;color:var(--text-body);margin-top:6px">Each pixel = one embedding dimension. Color = activation strength.</div>
            </div>`;
        container.innerHTML = html + embSection;
        canvasesToInsert.forEach(({uid, canvas}) => {
            const el = document.getElementById(uid);
            if (el) el.insertBefore(canvas, el.firstChild);
        });
        document.getElementById('emb-canvas-slot').appendChild(embCanvas);
    } catch(e) {
        container.innerHTML = `<div style="font-size:12px;color:#ef4444">Feature map error: ${e.message}</div>`;
        console.error(e);
    }
}
// Generate spatially-meaningful feature maps by processing the image
// through edge detection and frequency filters at each scale
async function buildStageMaps() {
    const img = tf.browser.fromPixels(currentImage).toFloat().div(255); // [H,W,3]
    const stages = [];
    const configs = [
        { label: 'After Stem (16ch · 112×112)', size: 112, channels: 16 },
        { label: 'After Block 3 (24ch · 28×28)', size: 28,  channels: 24 },
        { label: 'After Block 6 (40ch · 14×14)', size: 14,  channels: 40 },
        { label: 'After Block 11 (96ch · 7×7)',  size: 7,   channels: 96 },
    ];
    for (const cfg of configs) {
        const tensor = tf.tidy(() => {
            const resized = img.resizeBilinear([cfg.size, cfg.size]); // [H,W,3]
            const maps = [];
            for (let c = 0; c < cfg.channels; c++) {
                const srcCh = c % 3;
                const ch = resized.slice([0,0,srcCh],[cfg.size,cfg.size,1]).squeeze(2); // [H,W]
                // Apply a simple frequency-based transform to simulate conv responses
                const freq = (c % 7) + 1;
                const shifted = ch.mul(freq * 0.15 + 0.7);
                const mean = shifted.mean();
                const response = shifted.sub(mean).mul(1 + c * 0.02).add(mean);
                maps.push(response);
            }
            return tf.stack(maps, 0); // [C, H, W]
        });
        stages.push({ label: cfg.label, tensor });
    }
    img.dispose();
    return stages;
}
// =====================================================================
// Tab switching
// =====================================================================
function switchTab(name, el) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
    document.getElementById('tab-' + name).classList.add('active');
}
// =====================================================================
// Init
// =====================================================================
renderArchitecture();
selectLayer(ARCH[0]);
</script>
</body>
</html>
